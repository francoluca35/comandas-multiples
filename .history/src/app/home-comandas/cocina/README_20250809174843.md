# Vista de Cocina - Sistema de Gesti√≥n de Pedidos

## Descripci√≥n
La Vista de Cocina es un componente integral del sistema de gesti√≥n de restaurantes que permite al personal de cocina visualizar y gestionar los pedidos en tiempo real. Esta vista se integra directamente con el sistema de ventas, recibiendo autom√°ticamente los pedidos cuando los meseros finalizan una orden.

## Caracter√≠sticas Principales

### üîê Permisos de Acceso
- **ADMIN**: Acceso completo a la vista de cocina
- **COCINA**: Acceso completo a la vista de cocina
- **MESERO**: Sin acceso (solo pueden crear pedidos)
- **USUARIO**: Sin acceso

### üöÄ Funcionalidades
1. **Recepci√≥n Autom√°tica de Pedidos**: Los pedidos se env√≠an autom√°ticamente desde la pantalla de ventas
2. **Gesti√≥n de Estados**: Control del flujo de trabajo de los pedidos
3. **Vista en Tiempo Real**: Actualizaci√≥n autom√°tica de pedidos
4. **Interfaz Intuitiva**: Dise√±o claro y f√°cil de usar para el personal de cocina

### üìã Flujo de Trabajo
1. **Mesero crea pedido** ‚Üí Selecciona productos y presiona "Terminar"
2. **Sistema actualiza mesa** ‚Üí Cambia estado a "ocupado"
3. **Pedido se env√≠a a cocina** ‚Üí Se crea autom√°ticamente en la colecci√≥n `pedidosCocina`
4. **Cocinero ve pedido** ‚Üí Aparece en "Primeros Pedidos"
5. **Cocinero marca "Listo"** ‚Üí Pedido se mueve a "Pedidos Hechos"
6. **Pedido se marca "Realizado"** ‚Üí Se elimina del sistema

## Componentes

### PedidoCard
- **Prop√≥sito**: Muestra informaci√≥n detallada de un pedido individual
- **Informaci√≥n mostrada**:
  - N√∫mero de mesa
  - Lista de productos con cantidades
  - Notas especiales
  - Nombre del cliente
  - Botones de acci√≥n seg√∫n el estado

### CocinaPage
- **Prop√≥sito**: P√°gina principal que coordina toda la funcionalidad
- **Caracter√≠sticas**:
  - Integraci√≥n con Sidebar
  - Gesti√≥n de permisos
  - Manejo de estados de carga y errores
  - Actualizaci√≥n autom√°tica de datos

## Estructura de Datos

### Pedido de Cocina
```javascript
{
  id: "string",                    // ID √∫nico del pedido
  mesa: "string",                  // N√∫mero de mesa
  productos: [                     // Array de productos
    {
      nombre: "string",            // Nombre del producto
      cantidad: number,            // Cantidad solicitada
      precio: number,              // Precio unitario
      total: number,               // Total del producto
      notas: "string"              // Notas especiales
    }
  ],
  total: number,                   // Total del pedido
  cliente: "string",               // Nombre del cliente
  notas: "string",                 // Notas generales del pedido
  estado: "string",                // pendiente | en_preparacion | listo | realizado
  timestamp: Date,                 // Fecha de creaci√≥n
  updatedAt: Date                  // √öltima actualizaci√≥n
}
```

## Integraci√≥n con el Sistema

### API de Pedidos de Cocina
- **Endpoint**: `/api/pedidos-cocina`
- **M√©todos**:
  - `GET`: Obtener pedidos (con filtros opcionales)
  - `POST`: Crear nuevo pedido
  - `PUT`: Actualizar estado del pedido

### Hook usePedidosCocina
- **Funciones principales**:
  - `fetchPedidos()`: Cargar todos los pedidos
  - `crearPedido()`: Crear nuevo pedido
  - `actualizarEstadoPedido()`: Cambiar estado
  - `getPedidosPendientes()`: Obtener pedidos pendientes
  - `getPedidosListos()`: Obtener pedidos listos

### Integraci√≥n con Ventas
- **Trigger**: Bot√≥n "Terminar" en PedidoView
- **Acci√≥n**: Creaci√≥n autom√°tica de pedido en cocina
- **Datos transferidos**: Mesa, productos, cliente, total
- **Estado inicial**: "pendiente"

## Personalizaci√≥n

### Estados de Pedidos
Los estados se pueden personalizar modificando:
- `src/app/api/pedidos-cocina/route.js`
- `src/hooks/usePedidosCocina.js`

### Interfaz Visual
- Colores y estilos en `src/app/home-comandas/cocina/page.jsx`
- Componentes de UI en `src/components/ui/`

### Permisos
- Configuraci√≥n en `src/app/context/RoleContext.js`
- Validaci√≥n en `src/components/RoleGuard.js`

## Integraci√≥n Futura

### Funcionalidades Planificadas
1. **Notificaciones en Tiempo Real**: WebSockets para actualizaciones instant√°neas
2. **Sistema de Prioridades**: Asignar prioridades a pedidos urgentes
3. **Tiempo de Preparaci√≥n**: Tracking del tiempo de cada pedido
4. **Historial de Pedidos**: Registro completo de todos los pedidos procesados
5. **Integraci√≥n con Impresoras**: Env√≠o autom√°tico a impresoras de cocina

### APIs Externas
- **Firebase Cloud Messaging**: Para notificaciones push
- **WebSocket**: Para comunicaci√≥n en tiempo real
- **Impresoras de Cocina**: Para tickets f√≠sicos

## Testing

### Casos de Prueba
1. **Creaci√≥n de Pedido**: Verificar que se cree correctamente en cocina
2. **Cambio de Estado**: Probar transiciones entre estados
3. **Permisos**: Verificar acceso seg√∫n rol del usuario
4. **Errores**: Manejo de fallos en la API
5. **Carga de Datos**: Estados de loading y error

### Datos de Prueba
- Usar el bot√≥n "Recargar Pedidos" para verificar la funcionalidad
- Crear pedidos desde la pantalla de ventas
- Probar con diferentes roles de usuario

## Seguridad

### Validaciones
- **Autenticaci√≥n**: Verificaci√≥n de usuario logueado
- **Autorizaci√≥n**: Verificaci√≥n de permisos por rol
- **Datos**: Validaci√≥n de entrada en la API
- **Acceso**: Protecci√≥n de rutas con RestaurantGuard y RoleGuard

### Auditor√≠a
- **Logs**: Registro de todas las operaciones
- **Timestamps**: Fechas de creaci√≥n y modificaci√≥n
- **Usuarios**: Tracking de qui√©n realiza cada acci√≥n

## Mantenimiento

### Monitoreo
- **Logs de Consola**: Errores y operaciones exitosas
- **Estado de la API**: Respuestas y tiempos de respuesta
- **Uso de Recursos**: Memoria y rendimiento

### Actualizaciones
- **Dependencias**: Mantener actualizadas las librer√≠as
- **Firebase**: Verificar cambios en la API de Firestore
- **Next.js**: Actualizaciones del framework

## Soporte

### Problemas Comunes
1. **Pedidos no aparecen**: Verificar permisos y conexi√≥n a Firebase
2. **Errores de API**: Revisar logs del servidor
3. **Problemas de permisos**: Verificar configuraci√≥n de roles
4. **Carga lenta**: Optimizar consultas a Firestore

### Contacto
- **Desarrollador**: Equipo de desarrollo
- **Documentaci√≥n**: Este README y comentarios en el c√≥digo
- **Issues**: Sistema de tickets del proyecto
